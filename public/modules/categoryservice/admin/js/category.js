(()=>{"use strict";const e=class{constructor(e,t){this.selector=t,$.jstree.defaults.dnd.touch=!0,$.jstree.defaults.dnd.copy=!1,this.fetchCategoryServiceTree(),t.on("select_node.jstree",((t,a)=>e.fetchCategoryService(a.selected[0]))),t.on("loaded.jstree",(()=>t.jstree("open_all"))),this.selector.on("move_node.jstree",((e,t)=>{this.updateCategoryServiceTree(t)}))}fetchCategoryServiceTree(){this.selector.jstree({core:{data:{url:route("admin.category_services.tree")},check_callback:!0},plugins:["dnd"]})}updateCategoryServiceTree(e){this.loading(e.node,!0),$.ajax({type:"PUT",url:route("admin.category_services.tree.update"),data:{categoryservice_tree:this.getCategoryServiceTree()},success:t=>{success(t),this.loading(e.node,!1),this.clear()},error:t=>{error(t.responseJSON.message),this.loading(e.node,!1)}})}clear(){$("#id-field").addClass("hide"),$("#id").val(""),$("#name").val(""),$("#slug").val(""),$("#slug-field").addClass("hide"),$(".category-details-tab .seo-tab").addClass("hide"),$("#is_searchable").prop("checked",!1),$("#is_active").prop("checked",!1),$(".logo .image-holder-wrapper").html(this.imagePlaceholder()),$(".banner .image-holder-wrapper").html(this.imagePlaceholder()),$(".btn-delete").addClass("hide"),$(".form-categoryservice .help-block").remove(),$('#category-form input[name="parent_id"]').remove(),$(".general-information-tab a").click()}getCategoryServiceTree(){return this.selector.jstree(!0).get_json("#",{flat:!0}).reduce(((e,t)=>e.concat({id:t.id,parent_id:"#"===t.parent?null:t.parent,position:t.data.position})),[])}imagePlaceholder(){return'\n            <div class="image-holder placeholder">\n                <i class="fa fa-picture-o"></i>\n            </div>\n        '}loading(e,t){let a=this.selector.jstree().get_node(e,!0);t?$(a).addClass("jstree-loading"):$(a).removeClass("jstree-loading")}};new class{constructor(){let t=$(".categoryservice-tree");new e(this,t),this.collapseAll(t),this.expandAll(t),this.addRootCatgeoryService(),this.addSubGroup(),$("#categoryservice-form").on("submit",this.submit)}collapseAll(e){$(".collapse-all").on("click",(t=>{t.preventDefault(),e.jstree("close_all")}))}expandAll(e){$(".expand-all").on("click",(t=>{t.preventDefault(),e.jstree("open_all")}))}addRootCatgeoryService(){$(".add-root-categoryservice").on("click",(()=>{this.loading(!0),$(".add-sub-categoryservice").addClass("disabled"),$(".categoryservice-tree").jstree("deselect_all"),this.clear(),setTimeout(this.loading,150,!1)}))}addSubGroup(){$(".add-sub-categoryservice").on("click",(()=>{let e=$(".categoryservice-tree").jstree("get_selected")[0];void 0!==e&&(this.clear(),this.loading(!0),window.form.appendHiddenInput("#categoryservice-form","parent_id",e),setTimeout(this.loading,150,!1))}))}fetchCategoryService(e){this.loading(!0),$(".add-sub-categoryservice").removeClass("disabled"),$.ajax({type:"GET",url:route("admin.category_services.show",e),success:e=>{this.update(e),this.loading(!1)},error:e=>{error(e.responseJSON.message),this.loading(!1)}})}update(e){window.form.removeErrors(),$(".btn-delete").removeClass("hide"),$(".form-categoryservice .help-block").remove(),$("#confirmation-form").attr("action",route("admin.category_services.destroy",e.id)),$("#id-field").removeClass("hide"),$("#id").val(e.id),$("#name").val(e.name),$('input[name="meta[meta_title]"]').val(e.meta.meta_title??""),$('textarea[name="meta[meta_description]"]').val(e.meta.meta_description??""),$('input[name="meta[meta_keyword]"]').val(e.meta.meta_keyword??""),$("#slug").val(e.slug),e.intro?tinyMCE.get("intro").setContent(e.intro):tinyMCE.get("intro").setContent(""),$("#slug-field").removeClass("hide"),$(".categoryservice-details-tab .seo-tab").removeClass("hide"),$("#is_searchable").prop("checked",e.is_searchable),$("#is_active").prop("checked",e.is_active),$(".logo .image-holder-wrapper").html(this.categoryImage("logo",e.logo)),$(".banner .image-holder-wrapper").html(this.categoryImage("banner",e.banner)),$("#is_default_rating").prop("checked",e.is_default_rating),$("#custom_avg_rating").val(e.custom_avg_rating),$("#custom_rating_count").val(e.custom_rating_count>0?e.custom_rating_count:1),$('#categoryservice-form input[name="parent_id"]').remove()}categoryImage(e,t){return t.id?`\n            <div class="image-holder">\n                <img src="${t.path}">\n                <button type="button" class="btn remove-image" data-input-name="files[${e}]"></button>\n                <input type="hidden" name="files[${e}]" value="${t.id}">\n            </div>\n        `:this.imagePlaceholder()}imagePlaceholder(){return'\n            <div class="image-holder placeholder">\n                <i class="fa fa-picture-o"></i>\n            </div>\n        '}clear(){$("#id-field").addClass("hide"),$("#id").val(""),$("#name").val(""),tinyMCE.get("intro").setContent(""),$("#slug").val(""),$("#slug-field").addClass("hide"),$("#is_searchable").prop("checked",!1),$("#is_active").prop("checked",!1),$(".logo .image-holder-wrapper").html(this.imagePlaceholder()),$(".banner .image-holder-wrapper").html(this.imagePlaceholder()),$(".btn-delete").addClass("hide"),$(".form-categoryservice .help-block").remove(),$('#categoryservice-form input[name="parent_id"]').remove(),$(".general-information-tab a").click()}loading(e){!0===e?$(".overlay.loader").removeClass("hide"):$(".overlay.loader").addClass("hide")}submit(e){let t=$(".categoryservice-tree").jstree("get_selected")[0];$("#slug-field").hasClass("hide")||(window.form.appendHiddenInput("#categoryservice-form","_method","put"),$("#categoryservice-form").attr("action",route("admin.category_services.update",t))),e.currentTarget.submit()}}})();
